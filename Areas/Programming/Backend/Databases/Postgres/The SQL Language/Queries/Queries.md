>[PostgreSQL: Documentation: 15: Chapter 7. Queries](https://www.postgresql.org/docs/15/queries.html)

---
### Order of Operations

Queries happen in a specific order. This order can change based on the presence of keywords.

![](assets/images/postgres/queries/Screen%20Shot%202023-01-01%20at%208.40.19%20PM.png)
1. FROM
2. JOIN
3. WHERE 
4. GROUP-BY
5. HAVING 
6. SELECT
7. DISTINCT
8. ORDER-BY 
9. LIMIT

Joins Groupings and Aggregations all produce different things.

![](assets/images/postgres/queries/Screen%20Shot%202023-01-01%20at%2010.45.53%20PM.png)
![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%2012.09.34%20AM.png)

---
### Table Expressions
[[Table Expressions]]

---
### JOINS
> [PostgreSQL: Documentation: 15: SELECT](https://www.postgresql.org/docs/15/sql-select.html)

> [Joins CheatSheet](assets/images/postgres/queries/009_-_joins_-_cheatsheet.pdf)

A joined table is a table derived from two other (real or derived) tables according to the rules of the particular join type. Inner, outer, and cross-joins are available.

- Can use `JOIN ON a.id = b.id` or `JOIN USING "column name"`

Self Joins
- Self joins can allow things such as finding all pairs of items that have the same values (all movies with the same movie length etc)

Cross Joins
- Cross joins will perform every combination of every item from each table (for instance, every color for every shirt combination) - can also do an innter join on true to mimic cross join

Natural Joins
- Natural joins join tables by columns with the same column name - every column that is a common column from both tables is returned
- Natural joins use inner join by default
- Natural joins are equivalent to an inner join that uses the USING keyword

Tips
- The ON clause is part of the INNER, LEFT, RIGHT, and FULL joins. The CROSS join and UNION join don't have an ON clause because neither of them does any filtering of the data.
- The ON clause in an inner join is logically equivalent to a WHERE clause. i.e. the same condition could be specified either in an ON clause or a WHERE clause
- The ON clauses in outer join i.e. LEFT, RIGHT, and FULL joins are different from WHERE clauses.
- The WHERE clause simply filter the rows returned by the FROM clause. Rows rejected by the filter are not included in the result.
- The ON clause in an outer join first filters the rows of a cross product and then includes the rejected rows, extended with nulls values.

![](assets/images/postgres/queries/Screen%20Shot%202023-01-01%20at%2010.58.52%20PM.png)
![](assets/images/postgres/queries/Screen%20Shot%202023-01-01%20at%2011.16.43%20PM.png)

---
### Order By
> [PostgreSQL: Documentation: 15: 7.5. Sorting Rows (ORDER BY)](https://www.postgresql.org/docs/15/queries-order.html)

After a query has produced an output table (after the select list has been processed) it can optionally be sorted.

- Sort by ASC and DESC
- Can sort on multuple columns and the order of columns dictates what column is prioritized.
- Can use numbers to represent the columns you're ordering on. (Column name preferred)
- Can also use ORDER BY on nulls.

```
-- Using numbers

SELECT
	last_name, first_name
FROM actors
ORDER BY
	1 ASC
	2 DESC

-- Sorting on nulls

SELECT * from x ORDER BY num NULLS [LAST|FIRST]
```

![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%201.37.40%20AM.png)

---
### Offset Limit Fetch
> [PostgreSQL: Documentation: 15: 7.6. LIMIT and OFFSET](https://www.postgresql.org/docs/15/queries-limit.html)

> [PostgreSQL: Documentation: 15: FETCH](https://www.postgresql.org/docs/15/sql-fetch.html)

`LIMIT` and `OFFSET` and `FETCH` allow you to retrieve just a portion of the rows that are generated by the rest of the query:

- Can be used to select a specific amount of items
- Useful for paging

![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%201.41.52%20AM.png)

---
### Combining Queries
> [PostgreSQL: Documentation: 15: 7.4. Combining Queries (UNION, INTERSECT, EXCEPT)](https://www.postgresql.org/docs/15/queries-union.html)

The results of two queries can be combined using the set operations union, intersection, and difference.

- Can merge results of two separate queries
- Results must return same columns with same data types
- Except will only include the rows that exist in the first query

![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%202.08.42%20AM.png)
![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%202.07.09%20AM.png)
![](assets/images/postgres/queries/Screen%20Shot%202023-01-02%20at%204.59.13%20PM.png)

---
### Select Lists
>[PostgreSQL: Documentation: 15: 7.3. Select Lists](https://www.postgresql.org/docs/15/queries-select-lists.html)

As shown in the previous section, the table expression in the `SELECT` command constructs an intermediate virtual table by possibly combining tables, views, eliminating rows, grouping, etc. This table is finally passed on to processing by the _select list_. The select list determines which _columns_ of the intermediate table are actually output.

###### Distinct
>[PostgreSQL: Documentation: 15: 7.3. Select Lists](https://www.postgresql.org/docs/15/queries-select-lists.html#QUERIES-DISTINCT)

- Similar to group by, good for finding counts.
- Can't replace group by but group by can replace distinct.
- Finds unique values.
